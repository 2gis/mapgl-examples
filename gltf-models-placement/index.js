(()=>{"use strict";var e={9958:e=>{var t,n,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var l,d=[],s=!1,u=-1;function c(){s&&l&&(s=!1,l.length?d=l.concat(d):u=-1,d.length&&m())}function m(){if(!s){var e=i(c);s=!0;for(var t=d.length;t;){for(l=d,d=[];++u<t;)l&&l[u].run();u=-1,t=d.length}l=null,s=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function p(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new v(e,t)),1!==d.length||s||i(m)},v.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}(()=>{function e(e,t,n,o){return new(n||(n=Promise))((function(a,r){function i(e){try{d(o.next(e))}catch(e){r(e)}}function l(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}d((o=o.apply(e,t||[])).next())}))}Object.create;Object.create;let t="undefined"!=typeof Float64Array?Float64Array:Array;Math.random;Math.PI;function o(){let e=new t(3);return e[0]=0,e[1]=0,e[2]=0,e}!function(){let e=o()}();function a(){let e=new t(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}!function(){let e=a()}();function r(e,t,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function i(){let e=new t(2);return e[0]=0,e[1]=0,e}function l(e,n){let o=new t(2);return o[0]=e,o[1]=n,o}!function(){let e=i()}();const d=Math.pow(2,32);Math.pow(2,20),Math.pow(2,15),Math.pow(2,16);function s(e,t){return{min:e||l(1/0,1/0),max:t||l(-1/0,-1/0)}}var u=n(9958);u.env.TEST,u.env.TEST&&location.origin,[2,5,25].map((e=>1e3*e)),Math.PI,Math.pow(2,34);const c=d/(2*Math.PI*6378137);r([],[-1,-1,0],[2,2,1]),r([],[.5,.5,0],[.5,.5,1]);function m(e){return 1/Math.cos(p(e))}s([-d/2,-d/2],[d/2,d/2]),s([-100*d/2,-d/2],[100*d/2,d/2]);i(),i();o(),o(),a(),a();function v(e,t,n){return e=Math.max(e,t),e=Math.min(e,n)}function p(e){return e*Math.PI/180}function g(t){return e(this,void 0,void 0,(function*(){const e=(new TextEncoder).encode(t),n=yield crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}))}function f(e){const t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}const h={modelLocationInfo:{ru:"Для того, чтобы найти добавленную модель на карте, попробуйте подобрать подходящий масштаб, используя контролы зума или колесо мыши, а также нажать на элемент добавленной модели в панели инструментов для выставления центра карты",en:"To locate the added model on the map, try adjusting the appropriate scale using the zoom controls or the mouse wheel, and also click on the item in the added model list in the toolbar to center the map"},addModel:{ru:"Добавить модель",en:"Add model"},getSceneConfig:{ru:"Получить конфиг сцены",en:"Get scene config"},zoomRange:{ru:"Масштаб",en:"Scale"},pitchRange:{ru:"Наклон",en:"Pitch"},rotationRange:{ru:"Поворот",en:"Rotation"},modelParamCoords:{ru:"Координаты",en:"Coordinates"},modelParamCoordsInfo:{ru:"для перемещения модели используйте стрелки или ЛКМ и движение мышью",en:"to move the model, use the arrow keys or the left mouse button and mouse movement"},modelParamLng:{ru:"Долгота",en:"Longitude"},modelParamLat:{ru:"Широта",en:"Latitude"},modelParamLinkedObjects:{ru:"Связанные объекты",en:"Linked objects"},modelParamLinkedObjectsInfo:{ru:"для выбора скрытых зданий моделью кликайте на них ЛКМ",en:"to select buildings hidden by the model, click on them with the left mouse button"},modelParamLinkedIds:{ru:"ID зданий",en:"Building IDs"},modelParamRotation:{ru:"Поворот",en:"Rotation"},modelParamRotationInfo:{ru:"для поворота модели зажмите клавишу R, затем ЛКМ и подвигайте мышью",en:"to rotate the model, hold down the R key, then the left mouse button, and move the mouse"},modelParamScale:{ru:"Масштаб",en:"Scale"},modelParamScaleInfo:{ru:"для масштабирования модели зажмите клавишу S, затем ЛКМ и подвигайте мышью",en:"to scale the model, hold down the S key, then the left mouse button, and move the mouse"},pageLeaveMsg:{ru:"Вы уверены, что хотите покинуть страницу?",en:"Are you sure you want to leave the page?"},removeModelMsg:{ru:"Вы уверены, что хотите удалить модель?",en:"Are you sure you want to remove the model?"}},b=-180,y="en"!==new URL(location.href).searchParams.get("lang")?"ru":"en",L=window.map=new mapgl.Map("map",{center:[82.920412,55.030111],zoom:15,key:"a1893935-6834-4445-b97a-3405fb426c5b",enableTrackResize:!0,zoomControl:"centerRight",maxPitch:75,lowZoomMaxPitch:75,webglVersion:2,disableAntiAliasing:!1,lang:y});document.getElementById("main-wrap").innerHTML=`\n    <div id="bar">\n        <div id="model-add-info">${h.modelLocationInfo[y]}</div>\n        <div id="model-list"></div>\n        \x3c!-- <input\n            id="add-model-input"\n            type="file"\n            accept=".glb,.gltf,.png,.jpg,.jpeg,.bin"\n            multiple\n        /> --\x3e\n        <input id="add-model-input" type="file" accept=".glb" multiple />\n        <label for="add-model-input" id="add-model-label" class="control">\n            <span>${h.addModel[y]}</span>\n            <svg\n                width="24px"\n                height="24px"\n                viewBox="0 0 24 24"\n                fill="none"\n                xmlns="http://www.w3.org/2000/svg"\n            >\n                <path\n                    fill-rule="evenodd"\n                    clip-rule="evenodd"\n                    d="M10.5 10.5H7C6.17157 10.5 5.5 11.1716 5.5 12C5.5 12.8284 6.17157 13.5 7 13.5H10.5V17C10.5 17.8284 11.1716 18.5 12 18.5C12.8284 18.5 13.5 17.8284 13.5 17V13.5H17C17.8284 13.5 18.5 12.8284 18.5 12C18.5 11.1716 17.8284 10.5 17 10.5H13.5V7C13.5 6.17157 12.8284 5.5 12 5.5C11.1716 5.5 10.5 6.17157 10.5 7V10.5ZM24 12C24 18.6274 18.6274 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0C18.6274 0 24 5.37258 24 12Z"\n                    fill="#0075ff"\n                />\n            </svg>\n        </label>\n    </div>\n    <button id="config-button" type="button" class="control">${h.getSceneConfig[y]}</button>\n    <div id="map-controls">\n        <div>\n            <input type="number" id="zoom-value" min="0" max="0" value="0" step="0.01" />\n            <input\n                type="range"\n                id="zoom-range"\n                min="0"\n                max="0"\n                value="0"\n                step="0.01"\n                class="control"\n            />\n            <label for="zoom-range">${h.zoomRange[y]}</label>\n        </div>\n        <div>\n            <input type="number" id="pitch-value" min="0" max="0" value="0" step="0.01" />\n            <input\n                type="range"\n                id="pitch-range"\n                min="0"\n                max="0"\n                value="0"\n                step="0.01"\n                class="control"\n            />\n            <label for="pitch-range">${h.pitchRange[y]}</label>\n        </div>\n        <div>\n            <input\n                type="number"\n                id="rotation-value"\n                min="0"\n                max="0"\n                value="0"\n                step="0.01"\n            />\n            <input\n                type="range"\n                id="rotation-range"\n                min="0"\n                max="0"\n                value="0"\n                step="0.01"\n                class="control"\n            />\n            <label for="rotation-range">${h.rotationRange[y]}</label>\n        </div>\n    </div>`;const x=document.getElementById("model-add-info"),w=document.getElementById("model-list"),E=document.getElementById("model-params"),F=L._impl.getContainer(),M=new Map;let C,N,S,k="idle";function I(){if(!C)return;const e=M.get(C);if(!e)return;const t=e.linkedIds.join("\n"),n=C.getCoordinates(),o=C.getRotation(),a=C.getScale(),r=E.querySelector("#lng-value");r&&(r.value=n[0].toFixed(6));const i=E.querySelector("#lat-value");i&&(i.value=n[1].toFixed(6));const l=E.querySelector("#linkedids-value");l&&(l.value=t);const d=E.querySelector("#rotate-x-value");d&&(d.value=o[0].toFixed(2));const s=E.querySelector("#rotate-y-value");s&&(s.value=o[1].toFixed(2));const u=E.querySelector("#rotate-z-value");u&&(u.value=o[2].toFixed(2));const c=E.querySelector("#scale-value");c&&(c.value=a[0].toFixed(2))}function R(){const e=[];M.forEach((({linkedIds:t})=>e.push(...t))),L.setHiddenObjects(e)}function P(){const e=[];M.forEach((({linkedIds:t})=>e.push(...t))),L.unsetHiddenObjects(e)}!function(){document.getElementById("config-button").addEventListener("click",(()=>e(this,void 0,void 0,(function*(){const e=document.createElement("a"),t=[];for(const[e,{linkedIds:n,name:o}]of M.entries()){const[a,r]=e.getCoordinates(),i=e.getRotation(),l=e.getScale(),d=yield g(`${a}${r}${n.join("")}`),s=o.match(/(.*)\.glb$/);t.push({modelId:`${s?s[1]:o}_${d}`,coordinates:[a,r],modelUrl:o,interactive:!0,rotateX:i[0],rotateY:i[1],rotateZ:i[2],scale:l[0],linkedIds:n,floors:[]})}e.href=URL.createObjectURL(new Blob([JSON.stringify(t)],{type:"application/json"})),e.download="mapgl-gltf-config.json",e.click(),URL.revokeObjectURL(e.href)}))));const t=document.getElementById("add-model-input");t.addEventListener("change",(()=>e(this,void 0,void 0,(function*(){if(!t.files)return;const e=Array.from(t.files),n=new Map;e.forEach((e=>{e.name.match(/\.glb$/)&&n.set(e.name,URL.createObjectURL(e))})),t.value="",x.style.display="none",n.forEach(((e,t)=>{const n=new mapgl.GltfModel(L,{coordinates:L.getCenter(),modelSrc:e,interactive:!0,disableAnimation:!0,hover:{color:"#0F0"},select:{color:"#00C300"}}),o=function(e,t){const n=document.createElement("div");n.classList.add("model-item"),n.classList.add("control"),n.innerHTML='<span class="loader"></span>';const o=()=>{e.setState({hovered:!0}),n.classList.add("hovered")},a=()=>{e.setState({hovered:!1}),n.classList.remove("hovered")},r=()=>{M.forEach((({html:e},t)=>{t.setState({selected:!1}),e.classList.remove("selected")})),e.setState({selected:!0}),n.classList.add("selected"),C=e;const t=function(e){const t=document.createElement("div");t.innerHTML=`\n        <div>\n            <svg id="close-button" class="control" fill="#000000" width="20px" height="20px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n                <path d="M18.8,16l5.5-5.5c0.8-0.8,0.8-2,0-2.8l0,0C24,7.3,23.5,7,23,7c-0.5,0-1,0.2-1.4,0.6L16,13.2l-5.5-5.5  c-0.8-0.8-2.1-0.8-2.8,0C7.3,8,7,8.5,7,9.1s0.2,1,0.6,1.4l5.5,5.5l-5.5,5.5C7.3,21.9,7,22.4,7,23c0,0.5,0.2,1,0.6,1.4  C8,24.8,8.5,25,9,25c0.5,0,1-0.2,1.4-0.6l5.5-5.5l5.5,5.5c0.8,0.8,2.1,0.8,2.8,0c0.8-0.8,0.8-2.1,0-2.8L18.8,16z"/>\n            </svg>\n            <h4>${h.modelParamCoords[y]}</h4>\n            <p>${h.modelParamCoordsInfo[y]}</p>\n            <div class="model-params-item">\n                <label for="lng-value">${h.modelParamLng[y]}</label>\n                <input type="number" id="lng-value" min="-180" max="180" value="0" step="0.000001" />\n            </div>\n\n            <div class="model-params-item">\n                <label for="lat-value">${h.modelParamLat[y]}</label>\n                <input type="number" id="lat-value" min="-85.06" max="85.06" value="0" step="0.000001" />\n            </div>\n        </div>\n\n        <div>\n            <h4>${h.modelParamLinkedObjects[y]}</h4>\n            <p>${h.modelParamLinkedObjectsInfo[y]}</p>\n            <div class="model-params-item">\n                <label for="linkedids-value">${h.modelParamLinkedIds[y]}</label>\n                <textarea id="linkedids-value"></textarea>\n            </div>\n        </div>\n\n        <div>\n            <h4>${h.modelParamRotation[y]}</h4>\n            <p>${h.modelParamRotationInfo[y]}</p>\n            <div class="model-params-item">\n                <label for="rotate-x-value">X</label>\n                <input type="number" id="rotate-x-value" min="-360" max="360" value="0" step="0.01" />\n            </div>\n            <div class="model-params-item">\n                <label for="rotate-y-value">Y</label>\n                <input type="number" id="rotate-y-value" min="-360" max="360" value="0" step="0.01" />\n            </div>\n            <div class="model-params-item">\n                <label for="rotate-z-value">Z</label>\n                <input type="number" id="rotate-z-value" min="-360" max="360" value="0" step="0.01" />\n            </div>\n        </div>\n\n        <div>\n            <h4>${h.modelParamScale[y]}</h4>\n            <p>${h.modelParamScaleInfo[y]}</p>\n            <div class="model-params-item">\n                <label for="scale-value">X, Y, Z</label>\n                <input type="number" id="scale-value" min="0.01" max="${1/0}" value="0" step="0.01" />\n            </div>\n        </div>\n    `;t.querySelector("#close-button").addEventListener("click",(t=>{t.stopPropagation(),e===C&&(M.forEach((({html:e},t)=>{t.setState({selected:!1}),e.classList.remove("selected")})),E.style.display="none",E.innerHTML="",C=void 0)}));const n=t.querySelector("#lng-value");n.addEventListener("input",(({target:t})=>{const o=parseFloat(t.value);if(Number.isNaN(o))return;n.value=String(o);const a=e.getCoordinates();e.transform([{coordinates:[o,a[1]]}])})),n.addEventListener("change",(({target:e})=>{const t=parseFloat(e.value);Number.isNaN(t)||(n.value=t.toFixed(6),n.blur())}));const o=t.querySelector("#lat-value");o.addEventListener("input",(({target:t})=>{const n=parseFloat(t.value);if(Number.isNaN(n))return;o.value=String(n);const a=e.getCoordinates();e.transform([{coordinates:[a[0],n]}])})),o.addEventListener("change",(({target:e})=>{const t=parseFloat(e.value);Number.isNaN(t)||(o.value=t.toFixed(6),o.blur())}));const a=t.querySelector("#linkedids-value");a.addEventListener("change",(({target:t})=>{const n=M.get(e);if(!n)return;const o=t.value,r=o.length?Array.from(new Set(o.split("\n").filter((e=>e.length)))):[];P(),n.linkedIds=r,R(),a.value=r.join("\n"),a.blur()}));const r=t.querySelector("#rotate-x-value");r.addEventListener("input",(({target:t})=>{let n=parseFloat(t.value);if(Number.isNaN(n))return;n%=360,r.value=String(n);const o=e.getRotation();o[0]=n,e.transform([{rotation:o}])})),r.addEventListener("change",(({target:e})=>{const t=parseFloat(e.value);Number.isNaN(t)||(r.value=t.toFixed(2),r.blur())}));const i=t.querySelector("#rotate-y-value");i.addEventListener("input",(({target:t})=>{let n=parseFloat(t.value);if(Number.isNaN(n))return;n%=360,i.value=String(n);const o=e.getRotation();o[1]=n,e.transform([{rotation:o}])})),i.addEventListener("change",(({target:e})=>{const t=parseFloat(e.value);Number.isNaN(t)||(i.value=t.toFixed(2),i.blur())}));const l=t.querySelector("#rotate-z-value");l.addEventListener("input",(({target:t})=>{let n=parseFloat(t.value);if(Number.isNaN(n))return;n%=360,l.value=String(n);const o=e.getRotation();o[2]=n,e.transform([{rotation:o}])})),l.addEventListener("change",(({target:e})=>{const t=parseFloat(e.value);Number.isNaN(t)||(l.value=t.toFixed(2),l.blur())}));const d=t.querySelector("#scale-value");return d.addEventListener("input",(({target:t})=>{const n=parseFloat(t.value);Number.isNaN(n)||(d.value=String(n),e.transform([{scale:[n,n,n]}]))})),d.addEventListener("change",(({target:e})=>{const t=parseFloat(e.value);Number.isNaN(t)||(d.value=t.toFixed(2),d.blur())})),t}(e);E.innerHTML="",E.append(t),I(),E.style.display="block"};return n.addEventListener("mouseover",o),n.addEventListener("mouseout",a),n.addEventListener("click",(()=>{r(),L.setCenter(e.getCoordinates())})),e.on("mouseover",o),e.on("mouseout",a),e.on("click",r),e.on("mousedown",(t=>{if("idle"!==k)return;const n=t.originalEvent;k="capture",N=e,F.classList.add("mapgl-capture"),S=[n.clientX,n.clientY]})),e.on("modelloaded",(()=>{n.innerHTML=`\n            <span>${t}</span>\n            <svg fill="#000000" width="24px" height="24px" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><path d="M 15.7566 49.5476 L 40.2434 49.5476 C 44.8420 49.5476 46.8962 47.4001 47.5731 42.8248 L 51.0511 19.4118 L 51.5645 19.4118 C 54.4358 19.4118 56 17.6144 56 14.7665 L 56 11.2183 C 56 8.3705 54.4358 6.5731 51.5645 6.5731 L 4.4352 6.5731 C 1.7040 6.5731 0 8.3705 0 11.2183 L 0 14.7665 C 0 17.6144 1.5640 19.4118 4.4352 19.4118 L 4.9721 19.4118 L 8.4268 42.8248 C 9.1271 47.4234 11.1579 49.5476 15.7566 49.5476 Z M 5.3922 15.8870 C 4.2251 15.8870 3.7582 15.3968 3.7582 14.2296 L 3.7582 11.7553 C 3.7582 10.5881 4.2251 10.0979 5.3922 10.0979 L 50.6308 10.0979 C 51.7983 10.0979 52.2419 10.5881 52.2419 11.7553 L 52.2419 14.2296 C 52.2419 15.3968 51.7983 15.8870 50.6308 15.8870 Z M 15.8032 46.0228 C 13.7024 46.0228 12.5118 45.0891 12.1617 42.7782 L 8.6836 19.4118 L 47.3164 19.4118 L 43.8380 42.7782 C 43.5115 45.0891 42.2743 46.0228 40.1967 46.0228 Z M 21.2188 41.1441 C 21.7090 41.1441 22.1292 40.9107 22.4560 40.5839 L 27.9883 35.0516 L 33.5206 40.5839 C 33.8474 40.8874 34.2676 41.1441 34.7811 41.1441 C 35.7615 41.1441 36.5552 40.3038 36.5552 39.3234 C 36.5552 38.7865 36.3451 38.4130 36.0183 38.0629 L 30.5093 32.5539 L 36.0416 26.9749 C 36.3918 26.6014 36.5785 26.2513 36.5785 25.7611 C 36.5785 24.7573 35.7849 23.9637 34.7811 23.9637 C 34.3376 23.9637 33.9408 24.1504 33.5673 24.5239 L 27.9883 30.0562 L 22.4326 24.5472 C 22.0825 24.1971 21.7090 24.0104 21.2188 24.0104 C 20.2384 24.0104 19.4214 24.7807 19.4214 25.7611 C 19.4214 26.2746 19.6315 26.6715 19.9583 26.9983 L 25.4673 32.5539 L 19.9583 38.0862 C 19.6315 38.4130 19.4214 38.8098 19.4214 39.3234 C 19.4214 40.3038 20.2150 41.1441 21.2188 41.1441 Z"/></svg>\n        `;n.querySelector("svg").addEventListener("click",(t=>{t.stopPropagation();confirm(h.removeModelMsg[y])&&(e.destroy(),w.removeChild(n),e===C&&(E.style.display="none",E.innerHTML=""),w.children.length||(x.style.display="block"),P(),M.delete(e),R())}))})),w.append(n),n}(n,t);M.set(n,{html:o,name:t,linkedIds:[]})}))}))));const n=document.getElementById("zoom-value"),o=document.getElementById("zoom-range");n.min=L.getMinZoom().toFixed(2),n.max=L.getMaxZoom().toFixed(2),n.value=L.getZoom().toFixed(2),o.min=L.getMinZoom().toFixed(2),o.max=L.getMaxZoom().toFixed(2),o.value=L.getZoom().toFixed(2),n.addEventListener("change",(e=>{const t=e.target;let a=parseFloat(t.value);Number.isNaN(a)||(a=v(a,L.getMinZoom(),L.getMaxZoom()),n.value=a.toFixed(2),o.value=a.toFixed(2),L.setZoom(a))})),o.addEventListener("input",(e=>{const t=e.target,o=parseFloat(t.value);Number.isNaN(o)||(n.value=o.toFixed(2),L.setZoom(o))})),L.on("zoom",(({isUser:e})=>{if(!e)return;const t=Math.round(100*L.getZoom())/100;n.value=t.toFixed(2),o.value=t.toFixed(2)}));const a=document.getElementById("pitch-value"),r=document.getElementById("pitch-range");a.min=(0).toFixed(2),a.max=75..toFixed(2),a.value=L.getPitch().toFixed(2),r.min=(0).toFixed(2),r.max=75..toFixed(2),r.value=L.getPitch().toFixed(2),a.addEventListener("change",(e=>{const t=e.target;let n=parseFloat(t.value);Number.isNaN(n)||(n=v(n,0,75),a.value=n.toFixed(2),r.value=n.toFixed(2),L.setPitch(n))})),r.addEventListener("input",(e=>{const t=e.target,n=parseFloat(t.value);Number.isNaN(n)||(a.value=n.toFixed(2),L.setPitch(n))})),L.on("pitch",(({isUser:e})=>{if(!e)return;const t=Math.round(100*L.getPitch())/100;a.value=t.toFixed(2),r.value=t.toFixed(2)}));const i=document.getElementById("rotation-value"),l=document.getElementById("rotation-range");i.min=b.toFixed(2),i.max=180..toFixed(2),i.value=L.getRotation().toFixed(2),l.min=b.toFixed(2),l.max=180..toFixed(2),l.value=L.getRotation().toFixed(2),i.addEventListener("change",(e=>{const t=e.target;let n=parseFloat(t.value);Number.isNaN(n)||(n=v(n,b,180),i.value=n.toFixed(2),l.value=n.toFixed(2),L.setRotation(n))})),l.addEventListener("input",(e=>{const t=e.target,n=parseFloat(t.value);Number.isNaN(n)||(i.value=n.toFixed(2),L.setRotation(n))})),L.on("rotation",(({isUser:e})=>{if(!e)return;const t=Math.round(100*L.getRotation())/100;i.value=t.toFixed(2),l.value=t.toFixed(2)}))}(),function(){window.addEventListener("beforeunload",(e=>{const t=h.pageLeaveMsg[y];return e.returnValue=t,t})),window.addEventListener("keydown",(({code:e})=>{"Escape"===e&&"idle"===k&&(M.forEach((({html:e},t)=>{t.setState({selected:!1}),e.classList.remove("selected")})),E.style.display="none",E.innerHTML="",C=void 0)}));const e={ArrowUp:[0,1],ArrowDown:[0,-1],ArrowRight:[1,0],ArrowLeft:[-1,0]};let t;window.addEventListener("keydown",(({code:t})=>{if("idle"!==k)return;if(!C)return;if(!Object.keys(e).includes(t))return;if(Boolean(E.querySelectorAll("*:focus").length))return;const n=L.getRotation(),o=function(e,t){return[e[0]*Math.cos(t)-e[1]*Math.sin(t),e[0]*Math.sin(t)+e[1]*Math.cos(t)]}(e[t],p(n)),a=C.getCoordinates(),r=mapgl._J.utils.projectGeoToMap(a),i=.1*c*m(a[1]);r[0]+=o[0]*i,r[1]+=o[1]*i,C.transform([{coordinates:mapgl._J.utils.projectMapToGeo(r)}]),I()}));const n=e=>{if("scale"===k||"rotation"===k){if(e instanceof KeyboardEvent){if("KeyS"!==e.code&&"KeyR"!==e.code)return;if("rotation"===k&&"KeyS"===e.code)return;if("scale"===k&&"KeyR"===e.code)return}L._impl.modules.handler.unblock(),F.classList.remove("mapgl-scale","mapgl-rotate"),t=void 0,S=void 0,k="idle"}};window.addEventListener("keyup",n),window.addEventListener("mouseleave",n),window.addEventListener("keydown",(({code:e})=>{if("idle"!==k||!C)return;return Boolean(E.querySelectorAll("*:focus").length)||"KeyS"!==e&&"KeyR"!==e?void 0:(L._impl.modules.handler.block(),"KeyS"===e?(F.classList.add("mapgl-scale"),void(k="scale")):"KeyR"===e?(F.classList.add("mapgl-rotate"),void(k="rotation")):void 0)})),window.addEventListener("mousemove",(e=>{if("scale"!==k&&"rotation"!==k)return;if(!C)return;if(1!==e.buttons)return;if(!S||!t)return S=[e.clientX,e.clientY],void(t=C.getScale());const n=[e.clientX,e.clientY],o=L.project(C.getCoordinates()),a=[S[0]-o[0],S[1]-o[1]],r=[n[0]-o[0],n[1]-o[1]],i=f(a),l=f(r);if(i&&l){if("scale"===k){if(!t)return;C.transform([{scale:t.map((e=>Math.max(l*e/i,.01)))}])}else if("rotation"===k){const e=Math.sign((s=r,(d=a)[0]*s[1]-d[1]*s[0])),t=C.getRotation(),o=Math.acos(v(function(e,t){return e[0]*t[0]+e[1]*t[1]}(a.map((e=>e/i)),r.map((e=>e/l))),-1,1));t[2]+=Math.round(-e*(o/Math.PI*180)*.5%360*100)/100,C.transform([{rotation:t}]),S=n}var d,s;I()}})),window.addEventListener("mouseup",(({button:e})=>{"scale"!==k&&"rotation"!==k||0===e&&(t=void 0,S=void 0)})),L._impl.on("click",(({target:e})=>{if("idle"!==k||!e||!C)return;const{symbol:t}=e;if("polygonExtrusion"!==t&&"buildingModel"!==t&&"gltfModel"!==t)return;const n=M.get(C);n&&(n.linkedIds.includes(e.id)?L.triggerRerender():(n.linkedIds.push(e.id),R(),I()))}));const o=()=>{"capture"===k&&(L._impl.modules.handler.unblock(),S=void 0,k="idle",N=void 0,F.classList.remove("mapgl-capture"))};window.addEventListener("mouseup",o),window.addEventListener("mouseleave",o),window.addEventListener("mousemove",(e=>{if("capture"!==k||!S||!N)return;L._impl.modules.handler.block();const t=[e.clientX,e.clientY],n=L.project(N.getCoordinates()),o=[t[0]-S[0],t[1]-S[1]];N.transform([{coordinates:L.unproject([n[0]+o[0],n[1]+o[1]])}]),S=t,N===C&&I()}))}()})()})();